<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Agenda CRCM Simplificada</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<style>
body{font-family:sans-serif;margin:0;padding:0;background:#fff5f9;color:#333}
main{max-width:600px;margin:40px auto;padding:20px;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
input,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;font-size:1em}
button{background:#ec4899;color:white;cursor:pointer}
.card{border:1px solid #f3d1e6;background:#fff9fb;border-radius:8px;padding:10px;margin-top:10px}
h1{text-align:center;color:#ec4899}
</style>
</head>
<body>
<main>
  <h1>Agenda CRCM</h1>
  <div id="login">
    <input id="email" placeholder="E-mail" />
    <input id="senha" type="password" placeholder="Senha" />
    <button onclick="login()">Entrar</button>
  </div>
  <div id="agenda" style="display:none">
    <h2>Semana Atual</h2>
    <div id="lista"></div>
    <button onclick="sair()">Sair</button>
  </div>
</main>
<script>
const SUPABASE_URL = "https://cvkofcosarowxzhxenhn.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a29mY29zYXJvd3h6aHhlbmhuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwODkwNTUsImV4cCI6MjA3NjY2NTA1NX0.dnc9dtzdK5_u7Pyw_hJjuz9DFcassfLu7YBCI4rVuD0";
const supa = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

async function login(){
  const email=document.getElementById('email').value;
  const senha=document.getElementById('senha').value;
  const {data,error}=await supa.auth.signInWithPassword({email,password:senha});
  if(error){alert("Erro: "+error.message);return;}
  document.getElementById('login').style.display='none';
  document.getElementById('agenda').style.display='block';
  carregarAgenda();
}
async function carregarAgenda(){
  const hoje=new Date(); const semInicio=new Date(hoje.setDate(hoje.getDate()-hoje.getDay()+1));
  const semFim=new Date(semInicio); semFim.setDate(semInicio.getDate()+4);
  const {data,error}=await supa.from('appointments').select('*').gte('date',semInicio.toISOString().slice(0,10)).lte('date',semFim.toISOString().slice(0,10));
  if(error){alert("Erro: "+error.message);return;}
  const lista=document.getElementById('lista');
  lista.innerHTML='';
  data.forEach(a=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<b>${a.client}</b><br>${a.type} (${a.tech_id})<br>${a.date} ${a.start}:00â€“${a.end}:00`;
    lista.appendChild(div);
  });
}
async function sair(){
  await supa.auth.signOut();
  location.reload();
}
</script>
</body>
</html>
